<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
	<link href="layui/css/layui.css" rel="stylesheet">
    <title>layui测试页</title>
<style type="text/css">
	.img-list{
		padding: 5px;
	}
	.img-div{
		display: inline-block;
		text-align: center;
	}
	.img-url{
		display: block;
		width: 200px;
		height: 200px;
		margin: 0 10px 10px 0;
	}
	.img-del{
		margin-top: 5px;
	}
</style>
</head>
<body>
	<form id="frm">
		<button type="button" class="layui-btn" id="test">上传图片</button>
		<div id="imgDIV" class="img-list"></div>
	</form>
	<button onclick="saveImg();">保存</button>

</body>

<script src="jquery.js"></script>
<script src="layui/layui.all.js"></script>
<script type="text/javascript">
$(function(){

	//图片上传
	layui.upload.render({
		elem: '#test',
		accept: 'images',      // 指定允许上传时校验的文件类型，可选值有：images（图片）、file（所有文件）、video（视频）、audio（音频）
		acceptMime: 'image/*', // 打开文件选择框时，筛选出的文件类型
		auto: false, 		   // 是否选完文件后自动上传
		size: 10240,  		   // 设置文件最大可允许上传的大小，单位 KB， 不支持ie8/9
		multiple: true,		   // 是否允许多文件上传，设置 true即可开启，不支持ie8/9
		choose: function(obj){ // 选择文件后的回调
			//预读本地文件示例，不支持ie8
			obj.preview(function(index, file, result){
				$('#imgDIV').append('<div class="img-div">' +
									'<input type="hidden" id="' + ('file'+index) +  '" name="fileData" value="' + result + '">' +
									'<img class="img-url" src="'+ result +'" alt="'+ file.name +'">' +
									'<button class="img-del" onclick="delImg(this);">删除</button>' +
									'</div>');

			});
		}
	});
});

/**
 * 删除图片
 */
function delImg(obj){
	$(obj).parent(".img-div").remove();
}

/**
 * 保存图片
  */
function saveImg(){

	var fileData = new Array();
	$("input[name='fileData']").each(function(){
		fileData.push($(this).val());
	});

	if (fileData.length > 3) {
		alert("最多上传3张图片！");
		return;
	}

	$.ajax({
		type: "POST",
		url:"uploadBase64Img",
		contentType:"application/json;charset=utf-8",
		dataType: "json",
		data: JSON.stringify({ "fileData":fileData}),
		async: false,
		error: function(request) {
			alert("上传失败");
		},
		success: function(data) {
			if (data.flag == true) {
				alert("上传成功!");
			}
		}
	});

}

</script>
</html>
